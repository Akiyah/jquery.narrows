!function(a){var b={__relations:{},__options:{},__ukeys:{},__ukey_name:"jquery-narrows-unique-key",__default_params:{disable_if_parent_is_null:!0,null_value:""},init:function(c,d){var e=this,f=a(c);b.check_parameters(e,f);var g={};for(var h in b.__default_params)g[h]=void 0===d[h]?b.__default_params[h]:d[h];return d=g,b.add_new_relations(e,f,d),d.disable_if_parent_is_null&&f.attr("disabled","disabled"),e.on("change init",b.onchange_handler).trigger("init"),e},check_parameters:function(b,c){for(var d=[b,c],e=0,f=d.length;f>e;e++){var g=d[e];0===g.size()&&a.error("selector "+g.selector+": element not found"),g.each(function(){"SELECT"!=a(this).prop("tagName")&&a.error("selector "+g.selector+": includes non-select element(s)"),a(this).attr("id")||a.error("id is required for all select elements")})}var h=b.map(function(){return a(this).attr("id")});c.each(function(){for(var b=0,c=h.length;c>b;b++){var d="data-"+h[b],e=a(this);e.find("option").each(function(){var b=a(this);if(b.val()&&!b.attr(d)){var c=e.attr("id");a.error('options of select "#'+c+'" require "'+d+'" attribute')}})}})},add_new_relations:function(c,d,e){var f=[];c.each(function(){var c=b.unique_key(a(this));f.push(c)});var g=[];d.each(function(){var c=b.unique_key(a(this));g.push(c),b.__options[c]=a(this).find("option").get()});for(var h=0,i=f.length;i>h;h++){var j=f[h];b.__relations[j]||(b.__relations[j]=[]),b.__relations[j].push({$parents:c,$children:d,params:e,initialized:!1})}},unique_key:function(a){var c=a.data(b.__ukey_name);if(c)return c;do c=(0|1e7*Math.random()).toString(16);while(void 0!==b.__ukeys[c]);return a.data(b.__ukey_name,c),b.__ukeys[c]=1,c},onchange_handler:function(c){for(var d=a(this).data(b.__ukey_name),e=b.__relations[d],f=0,g=e.length;g>f;f++){var h=e[f];if("init"!=c.type||!h.initialized){h.initialized=!0;var i={},j=!0;h.$parents.each(function(){var b=a(this).val();return b==h.params.null_value?(j=!1,!1):(i[a(this).attr("id")]=b,void 0)}),j?(console.log("hmm"),h.$children.each(function(){b.add_relevant_options(a(this),i)})):h.params.disable_if_parent_is_null?h.$children.each(function(){b.remove_all_options(a(this),h.params)}):h.$children.each(function(){b.add_all_options(a(this),h)}),h.$children.trigger(c.type)}}},add_relevant_options:function(c,d){var e=c.val();c.removeAttr("disabled").find('option[value!=""]').remove();for(var f=b.get_all_options_of(c),g=0,h=f.length;h>g;g++){var i=a(f[g]),j=!0;for(var k in d){var l=d[k];if(i.data(k)!=l){j=!1;break}}j&&(i.val()==e&&i.prop("selected",!0),c.append(i))}},add_all_options:function(c){var d=c.val();c.removeAttr("disabled").find('option[value!=""]').remove();for(var e=b.get_all_options_of(c),f=0,g=e.length;g>f;f++){var h=a(e[f]);h.val()==d&&h.prop("selected",!0),c.append(h)}},remove_all_options:function(a,b){a.attr("disabled","disabled").val(b.null_value).find('option[value!=""]').remove()},get_all_options_of:function(a){var c=a.data(b.__ukey_name);return b.__options[c]}};a.fn.narrows=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&"string"!=typeof c&&c?(a.error("Method "+c+" does not exist on jQuery.narrows"),void 0):b.init.apply(this,arguments)}}(jQuery);